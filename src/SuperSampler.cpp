// A Sony SPC700 chip (from Nintendo SNES) emulator module.
// Copyright 2020 Christian Kauten
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//

#include "plugin.hpp"
#include "dsp/math.hpp"
#include "dsp/trigger.hpp"
#include "dsp/sony_s_dsp/brr_sample_player.hpp"
#include "dsp/wavetable4bit.hpp"

// ---------------------------------------------------------------------------
// MARK: Module
// ---------------------------------------------------------------------------

/// A Sony S-DSP chip (from Nintendo SNES) emulator module.
struct SuperSampler : Module {
 public:
    /// the number of voices on the module
    static constexpr unsigned NUM_VOICES = 8;

 private:
    /// the RAM for the S-DSP chip (64KB = 16-bit address space)
    uint8_t ram[SonyS_DSP::BRR_SamplePlayer::SIZE_OF_RAM];
    /// the Sony S-DSP sound chip emulator
    SonyS_DSP::BRR_SamplePlayer apu[NUM_VOICES][PORT_MAX_CHANNELS];
    /// triggers for handling gate inputs for the voices
    Trigger::Threshold gateTriggers[NUM_VOICES][PORT_MAX_CHANNELS];
    /// triggers for handling inputs to the phase modulation enable ports
    Trigger::Threshold pmTriggers[NUM_VOICES][PORT_MAX_CHANNELS];

 public:
    /// the indexes of parameters (knobs, switches, etc.) on the module
    enum ParamIds {
        ENUMS(PARAM_FREQ,      NUM_VOICES),
        ENUMS(PARAM_PM_ENABLE, NUM_VOICES),
        ENUMS(PARAM_VOLUME_L,  NUM_VOICES),
        ENUMS(PARAM_VOLUME_R,  NUM_VOICES),
        NUM_PARAMS
    };

    /// the indexes of input ports on the module
    enum InputIds {
        ENUMS(INPUT_VOCT,      NUM_VOICES),
        ENUMS(INPUT_FM,        NUM_VOICES),
        ENUMS(INPUT_PM_ENABLE, NUM_VOICES),
        ENUMS(INPUT_GATE,      NUM_VOICES),
        ENUMS(INPUT_VOLUME_L,  NUM_VOICES),
        ENUMS(INPUT_VOLUME_R,  NUM_VOICES),
        NUM_INPUTS
    };

    /// the indexes of output ports on the module
    enum OutputIds {
        ENUMS(OUTPUT_AUDIO_L, NUM_VOICES),
        ENUMS(OUTPUT_AUDIO_R, NUM_VOICES),
        NUM_OUTPUTS
    };

    /// the indexes of lights on the module
    enum LightIds {
        NUM_LIGHTS
    };

    /// @brief Initialize a new S-DSP Chip module.
    SuperSampler() {
        config(NUM_PARAMS, NUM_INPUTS, NUM_OUTPUTS, NUM_LIGHTS);
        for (unsigned osc = 0; osc < NUM_VOICES; osc++) {
            auto osc_name = "Voice " + std::to_string(osc + 1);
            configParam(PARAM_FREQ     + osc, -6.f, 6.f, 4.f, osc_name + " Frequency", " Hz", 2, dsp::FREQ_C4);
            configParam(PARAM_VOLUME_L + osc, -128, 127, 127, osc_name + " Volume (Left)");
            configParam(PARAM_VOLUME_R + osc, -128, 127, 127, osc_name + " Volume (Right)");
            osc_name = "Voice " + std::to_string(osc) + " -> " + osc_name;
            configParam(PARAM_PM_ENABLE + osc, 0, 1, 0, osc_name + " Phase Modulation Enable");
        }
        for (unsigned voice = 0; voice < NUM_VOICES; voice++)
            for (unsigned channel = 0; channel < PORT_MAX_CHANNELS; channel++)
                setupSourceDirectory(voice, channel);
    }

 protected:
    /// Setup the register initial state on the chip.
    inline void setupSourceDirectory(unsigned voice, unsigned channel) {
        apu[voice][channel].set_ram(ram);
        // -------------------------------------------------------------------
        // MARK: Source Directory (Sample RAM)
        // -------------------------------------------------------------------
        // write the first directory to RAM (at the end of the echo buffer)
        auto dir = reinterpret_cast<SonyS_DSP::SourceDirectoryEntry*>(&ram[0]);
        // point to a block immediately after this directory entry
        dir->start = 4;
        dir->loop = 4;
        // set address 256 to a single sample ramp wave sample in BRR format
        // the header for the BRR single sample waveform
        // auto block = reinterpret_cast<SonyS_DSP::BitRateReductionBlock*>(&ram[4]);
        // block->header.flags.set_volume(SonyS_DSP::BitRateReductionBlock::MAX_VOLUME);
        // block->header.flags.filter = 0;
        // block->header.flags.is_loop = 1;
        // block->header.flags.is_end = 1;
        // static const uint8_t samples[8] = {0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF};
        // for (unsigned i = 0; i < SonyS_DSP::BitRateReductionBlock::NUM_SAMPLES; i++)
        //     block->samples[i] = samples[i];

        int8_t hyaw[13083] = {0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,-1,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,-1,-2,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,-1,-2,-2,-1,0,0,-1,-2,-2,-2,-2,-1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-1,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,-2,-1,0,0,-1,-1,-2,-2,-1,0,0,1,1,1,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,-1,-2,-3,-2,-1,-2,-1,-1,-2,-1,-1,-1,0,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,-1,-2,-3,-3,-2,0,0,0,-1,-1,-2,-2,-1,0,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-2,-2,-2,-1,-1,-1,0,0,0,0,-1,0,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,-2,-2,-1,0,0,0,0,-1,-1,0,0,1,0,0,1,0,0,0,0,0,0,1,1,0,0,0,-1,-1,0,0,0,0,-1,-2,-2,-2,-2,-2,0,1,1,0,0,-2,-1,0,0,1,0,1,0,0,0,0,0,1,1,1,0,0,0,-1,0,0,0,0,0,-1,-2,-3,-3,-3,-1,1,1,0,0,-2,-2,-1,0,1,0,1,0,0,0,0,0,1,1,1,1,0,0,-1,-1,0,0,0,0,-1,-2,-3,-3,-3,-2,0,1,1,0,-1,-2,-1,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,-1,-1,0,0,0,0,-1,-2,-2,-1,-1,0,0,-1,-1,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,-1,-1,-1,-1,0,1,0,0,0,-1,-2,-1,0,1,1,1,0,0,-2,-2,0,0,1,1,1,0,0,-1,-1,0,1,1,0,0,-2,-2,-3,-3,0,1,1,0,-1,-2,-2,-1,0,1,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,-2,-2,-3,-4,-3,0,1,1,0,-1,-2,-1,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,-1,-1,0,0,0,-1,-2,-2,-2,-1,-1,-1,-1,0,0,1,1,1,0,0,0,1,0,0,1,0,-1,-1,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,1,1,0,-1,-1,0,0,0,1,0,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-3,-3,0,1,1,0,-1,-3,-2,-1,0,0,0,1,0,0,0,0,1,0,0,1,0,0,-1,-1,0,0,0,0,-2,-2,-3,-4,-4,0,1,2,1,0,-1,-1,0,1,0,0,0,1,0,-1,-1,0,0,0,0,0,-1,-2,-2,-1,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,-1,-1,-1,-1,-1,0,1,1,0,-2,-2,-1,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,-1,-2,-3,-3,-3,-1,1,0,1,0,-1,-1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,-1,-2,-3,-4,-2,1,0,0,1,0,-2,-1,0,1,0,1,0,0,-1,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,-1,0,0,0,0,-2,-2,0,0,1,1,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-3,-3,-1,1,0,1,0,-1,-2,-1,0,1,2,1,0,0,-1,-1,-1,0,1,1,0,0,0,-1,0,0,0,0,-1,-2,-3,-4,-4,0,0,0,1,0,0,-2,-1,0,0,0,1,0,0,-1,-2,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,-1,-3,-4,-1,0,0,0,0,-1,-2,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,-1,-2,-1,-1,-1,0,1,1,0,0,0,0,0,0,1,1,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-3,-2,0,0,0,0,0,-1,-1,0,0,1,1,1,0,0,-1,-1,0,0,1,1,0,0,0,0,0,0,0,0,-1,-2,-3,-3,-2,0,0,0,1,0,-1,-2,0,1,0,0,0,0,-1,-2,-1,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,-2,-3,-4,-1,0,0,0,0,-1,-2,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,-1,-2,-1,-1,-1,-1,0,1,1,1,0,0,-1,-1,0,1,1,1,0,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-3,-3,-1,1,0,0,0,-1,-2,-2,0,1,0,0,1,0,-1,-2,-1,0,1,1,1,0,-1,-2,-1,0,0,0,0,0,-1,-3,-5,-3,0,0,0,0,0,-2,-2,-1,0,1,0,1,0,-1,-2,-1,0,0,0,0,0,1,0,-1,-1,-1,0,0,0,0,-2,-5,-3,1,0,0,1,0,-1,-1,0,1,0,1,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,-2,-3,-2,0,1,0,0,0,-1,-1,-1,0,1,0,1,0,0,-1,-1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,-1,0,1,0,1,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,0,1,0,0,0,-1,-2,-1,0,0,0,-1,-2,-3,-3,0,0,0,0,0,0,0,0,0,1,1,0,0,-1,-1,-1,-1,-1,-1,0,0,0,0,1,0,0,0,0,0,0,-1,-3,-4,-4,-1,1,0,1,0,0,0,0,1,0,1,0,0,-1,-1,0,0,0,0,-1,-1,0,0,1,0,0,0,0,0,0,-1,-4,-6,-3,1,0,0,1,-1,-2,-1,0,0,0,1,0,0,0,-1,-1,-1,-2,-1,0,1,0,1,0,0,0,0,0,0,0,-1,-2,-1,-1,-1,-3,-3,0,0,0,0,0,-1,-1,0,1,1,1,0,-1,-1,-1,0,0,-1,-1,0,0,1,0,0,0,0,0,0,0,0,-1,-1,-1,-2,-3,-2,0,0,0,0,0,-1,-1,0,0,0,0,0,-2,-1,0,0,0,-1,0,0,1,1,0,-2,-1,0,0,0,-1,-3,-4,-4,-2,1,0,0,1,0,0,-1,0,0,0,0,0,0,0,0,0,-1,-2,-1,0,0,0,1,0,-1,0,0,0,0,-2,-4,-4,-2,1,0,0,0,0,0,0,1,0,0,0,0,0,-2,-2,-1,0,0,0,0,1,1,1,0,0,0,0,0,0,-2,-3,-4,-4,-3,0,0,0,1,0,0,-1,0,1,0,0,0,0,-1,-1,-1,-1,-1,-3,-2,0,0,1,0,0,0,0,0,0,0,-1,-1,0,0,-2,-3,-3,0,1,0,1,0,-1,-1,0,1,1,1,0,-1,-1,-1,0,0,0,0,0,1,0,1,0,-1,0,0,0,0,0,-1,-3,-4,-3,0,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,0,-1,-2,-1,0,0,0,1,0,-1,0,0,0,0,-1,-3,-4,-3,-1,1,0,1,0,0,0,0,1,0,1,0,-2,-2,-1,0,0,0,-1,-1,0,0,0,0,-1,0,0,0,0,0,-3,-5,-5,-3,0,0,0,1,0,0,-1,0,0,0,1,0,-1,-1,-1,-1,-2,-3,-3,0,0,0,0,0,0,0,1,1,0,-2,-3,-3,-2,-2,-3,-4,-1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,-1,-2,-1,0,1,0,1,0,-1,0,0,0,0,0,0,0,-2,-3,-2,0,0,2,0,0,-1,0,1,1,0,0,0,0,0,0,-1,-3,-3,-1,0,0,0,1,0,0,0,0,0,-1,-1,-1,-1,-2,-4,-4,-2,1,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,-2,-2,0,0,0,0,0,0,0,0,0,-2,-3,-4,-4,-3,0,0,0,1,0,-1,-1,0,0,0,1,0,-1,0,0,-1,-1,-1,-1,0,1,1,0,0,0,1,1,0,0,-1,-3,-3,-3,-4,-2,1,0,0,0,0,0,0,0,1,1,0,0,0,0,-1,-2,-2,-1,0,0,1,1,0,0,0,0,0,0,0,0,-1,-3,-4,-2,1,0,0,1,0,-1,0,0,0,0,-1,-2,-1,0,0,0,-2,-1,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,-2,-2,-2,0,0,0,0,1,0,0,0,1,0,-1,-3,-3,-1,0,0,-1,-2,-1,1,0,0,1,0,-1,0,0,0,-2,-3,-4,-3,-3,-3,-1,1,0,0,1,0,0,0,0,0,0,-3,-3,-2,0,0,-1,-2,-1,0,0,0,0,0,0,0,1,0,-1,-3,-5,-5,-4,-2,0,0,0,1,1,0,0,1,0,0,-2,-1,0,0,0,-1,-3,-2,0,1,0,0,0,0,0,0,0,0,-1,-2,-3,-3,-3,-1,1,0,0,1,0,0,0,0,1,0,-2,-2,-1,0,0,0,-1,-1,0,1,0,1,0,0,0,0,0,0,-1,-2,-2,-3,-3,-3,0,0,0,0,1,0,0,1,0,1,-1,-2,-2,-1,-1,-2,-3,-2,0,0,0,0,1,0,0,0,0,-1,-3,-4,-3,-2,-2,-3,-4,-2,1,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,-2,-2,0,1,0,0,0,1,0,0,0,-2,-3,-3,-3,-4,-4,-2,0,0,0,1,1,1,1,0,0,0,-1,-3,-2,-2,-2,-2,-2,-1,0,0,0,0,1,0,1,1,0,-1,-3,-3,-4,-4,-4,-4,-2,1,0,0,0,1,0,0,0,1,-1,-3,-4,-2,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-2,-4,-5,-5,-4,-2,1,0,0,1,1,1,1,0,0,0,-1,-2,-2,-2,-3,-3,-2,-1,1,0,0,0,1,1,1,0,0,-1,-3,-4,-4,-4,-4,-4,-1,2,0,0,0,1,0,0,1,0,-2,-4,-2,0,0,0,-2,-3,-1,1,0,0,1,0,0,0,0,-1,-2,-3,-3,-3,-3,-2,-1,1,0,0,0,1,0,0,1,1,0,-2,-3,-1,-1,-2,-2,-2,0,1,0,0,0,1,0,0,0,0,-2,-3,-3,-2,-2,-3,-4,-4,0,0,1,0,0,0,0,0,0,-1,-4,-5,-2,0,0,0,-2,-1,1,0,0,0,0,0,0,0,-1,-3,-4,-5,-4,-3,-2,0,0,0,0,0,1,1,1,1,0,-3,-4,-3,-1,0,-1,-2,-1,0,0,0,0,1,0,0,0,0,-1,-3,-4,-3,-2,-2,-2,-1,1,0,0,0,1,0,0,1,1,0,-2,-3,-2,-2,-2,-2,-2,-1,0,0,0,0,0,1,0,0,-1,-2,-3,-3,-2,-1,-1,-1,-2,-2,0,0,1,0,0,0,0,0,0,0,-2,-4,-3,-1,0,-1,-2,-2,0,0,1,1,0,0,0,-1,-2,-3,-4,-5,-4,-2,-1,0,-1,-1,0,0,1,0,0,1,0,-1,-2,-5,-5,-4,-2,0,0,0,0,1,0,0,0,0,0,0,-1,-2,-3,-4,-4,-4,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,-2,-5,-5,-3,-1,-1,0,0,0,1,0,0,0,0,0,0,0,-1,-2,-3,-4,-3,-2,0,0,-1,0,1,0,0,0,1,0,0,0,0,-3,-4,-4,-2,-1,-1,-1,0,0,0,0,0,0,1,0,0,-1,-3,-4,-4,-4,-2,0,0,0,-1,-1,1,0,1,0,0,0,-1,-1,-1,-3,-5,-5,-3,0,0,1,0,1,0,0,0,0,1,0,-2,-3,-3,-3,-3,-3,-2,0,0,-1,-1,0,0,1,0,0,0,-1,-1,-2,-4,-5,-4,-2,0,0,0,0,1,1,0,0,0,1,0,-1,-1,-2,-4,-4,-4,-2,-1,0,0,0,0,0,0,0,0,1,0,-1,-2,-3,-5,-5,-3,-1,0,0,0,1,0,0,0,0,1,0,-1,-1,-2,-3,-4,-3,-2,-1,0,-1,-1,1,0,0,0,2,0,0,0,0,-2,-4,-4,-3,-1,0,-1,-1,0,1,0,1,0,0,0,-1,-2,-3,-5,-5,-4,-3,0,0,0,0,0,1,0,1,1,0,1,-1,-2,-3,-5,-5,-5,-2,0,1,1,1,1,0,0,0,0,1,0,-1,-3,-4,-4,-4,-4,-2,0,0,0,0,0,0,1,0,0,0,-1,-2,-2,-5,-6,-4,-2,0,1,1,1,1,0,0,0,0,0,-1,-2,-2,-3,-4,-4,-3,-1,0,0,0,0,1,0,1,0,0,0,-2,-3,-3,-4,-5,-3,-1,0,1,1,1,1,1,0,0,0,1,0,-2,-2,-3,-4,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-2,-4,-4,-3,-1,0,0,0,0,1,0,0,0,0,0,-2,-3,-3,-4,-5,-4,-2,0,1,0,1,0,0,0,0,0,0,1,-1,-3,-4,-4,-4,-4,-2,0,1,0,0,0,0,1,1,1,0,0,-1,-2,-3,-3,-2,-2,-1,0,0,0,0,1,0,1,0,1,0,-3,-3,-2,-3,-4,-3,-1,0,1,1,1,1,1,0,0,0,0,-2,-3,-3,-2,-3,-3,-2,-1,0,0,0,1,0,1,0,0,1,-1,-3,-3,-5,-5,-3,-1,0,1,1,1,1,1,1,1,0,1,0,-2,-2,-2,-3,-3,-2,-1,0,1,1,0,0,0,0,0,0,1,0,-1,-1,-2,-2,-3,-3,-1,0,1,1,0,0,1,0,0,2,0,0,-2,-3,-3,-3,-3,-2,0,0,1,1,0,0,0,1,0,0,1,0,-2,-2,-2,-3,-3,-3,-1,1,0,0,0,1,1,1,1,0,-1,-2,-2,-3,-2,-2,-1,0,0,0,0,-1,0,0,0,0,0,0,-1,-3,-3,-4,-4,-3,-1,0,0,0,1,0,1,0,0,1,0,0,-3,-4,-3,-2,-3,-2,0,0,0,0,0,1,0,0,0,1,0,-3,-3,-3,-4,-4,-2,0,1,0,0,1,1,1,1,1,0,0,-2,-3,-2,-2,-3,-2,-1,0,1,1,1,0,0,1,0,0,1,0,-1,-2,-2,-3,-3,-2,-1,0,0,0,0,1,1,1,1,0,0,-1,-3,-4,-2,-2,-1,-1,0,1,1,1,0,0,0,0,1,1,0,-1,-3,-2,-1,-1,-1,-1,0,1,2,1,0,0,0,1,1,1,0,-1,-2,-2,-2,-2,-1,-1,0,0,0,0,-1,-1,1,0,0,0,0,-3,-3,-2,-2,-3,-3,-1,0,0,0,0,0,0,1,1,1,0,-1,-3,-3,-2,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,-2,-4,-3,-2,-3,-2,-1,0,0,0,1,1,1,1,0,1,0,-1,-3,-2,-2,-2,-2,-1,0,0,1,1,0,0,1,0,0,1,0,-2,-3,-2,-2,-3,-2,0,0,1,0,0,1,0,0,0,0,0,-1,-2,-2,-1,-1,-1,0,0,0,1,1,0,0,0,0,0,1,0,0,-2,-2,-1,0,0,0,0,0,1,1,1,0,-1,-1,0,0,1,1,0,0,0,0,-1,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,-1,-2,-3,-2,0,1,0,1,0,0,0,1,1,0,0,0,0,0,0,-1,-2,-2,-2,-1,-1,-1,0,0,0,0,0,0,-1,-3,-3,-3,-4,-3,-1,0,1,0,1,0,1,1,1,1,0,-1,-2,-2,-2,-2,-3,-2,-1,0,0,0,0,0,0,0,0,1,-1,-3,-3,-3,-4,-3,-1,0,1,1,1,1,1,1,1,0,0,0,-1,-1,-2,-2,-2,-1,0,0,1,1,1,0,0,0,1,1,0,0,-1,-1,-1,-1,-1,-1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,-1,0,1,0,0,0,0,-1,0,0,-2,-3,-2,0,1,0,0,1,0,0,1,1,0,0,-1,-1,-1,-1,-1,-2,-2,-2,-2,-1,0,0,1,1,0,1,0,-3,-4,-4,-5,-4,-2,0,0,0,0,1,1,0,0,1,0,0,-3,-3,-2,-2,-3,-2,0,0,0,0,0,1,0,0,0,1,0,-3,-3,-3,-5,-5,-3,0,1,0,0,0,1,1,1,1,0,-1,-2,-2,-2,-2,-2,-1,0,0,1,0,0,1,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,1,1,1,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,0,1,0,1,0,-1,-1,0,0,-1,-2,-1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-3,-2,-1,-1,-2,-1,1,0,1,0,1,0,-1,-2,-2,-3,-4,-3,-1,1,0,2,0,0,1,1,1,1,0,0,-1,-2,-2,-3,-3,-2,-2,-1,0,0,0,0,0,0,0,1,0,-3,-3,-3,-4,-4,-2,0,1,0,0,1,1,1,1,1,0,0,-2,-2,-2,-2,-3,-2,-1,0,0,0,1,0,1,0,0,1,0,-1,-3,-3,-2,-3,-3,-1,0,1,0,0,1,0,0,0,0,0,-1,-2,-2,-1,-1,-1,-1,0,0,1,1,1,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,1,1,1,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,2,0,-1,-2,-1,-1,-2,-3,-2,0,1,0,1,0,0,0,0,1,0,0,0,0,-1,-1,-1,-2,-2,-1,-1,-1,-1,0,0,1,0,0,1,0,-2,-3,-4,-5,-4,-2,0,0,0,0,1,0,0,1,0,0,-1,-2,-2,-1,-2,-3,-2,-1,0,0,0,0,1,0,0,0,1,0,-3,-3,-2,-4,-5,-3,0,1,0,0,1,1,1,1,1,0,-1,-2,-2,-1,-2,-2,-2,-1,0,0,1,1,0,0,1,0,0,0,0,-2,-3,-2,-1,-1,-1,0,0,1,0,0,1,0,0,0,0,-1,-1,-2,-2,-1,0,0,0,0,0,1,0,0,-1,0,0,1,1,0,-1,-1,-1,0,0,-1,-1,0,1,0,1,0,0,-1,-1,0,0,1,0,0,0,0,0,-1,-2,-2,-2,-1,-1,-1,-1,0,0,0,0,1,0,-1,-1,-1,-3,-4,-3,-1,0,0,0,1,0,1,1,1,1,0,0,-1,-1,-1,-2,-2,-3,-2,-1,0,0,0,0,0,1,0,1,0,-2,-3,-2,-4,-5,-3,-2,0,0,0,1,1,1,0,1,1,0,-2,-2,-2,-1,-2,-3,-2,-1,0,0,0,0,0,0,0,0,1,0,-2,-3,-3,-3,-4,-3,-1,0,0,0,0,1,1,1,0,0,0,-1,-2,-2,-1,-1,-1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,1,1,1,1,0,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,-1,0,0,1,0,1,0,-1,-1,0,-1,-2,-2,-1,0,0,0,1,0,0,0,0,0,-1,-1,0,0,0,0,0,-1,-2,-2,-1,-1,-2,-1,0,0,0,0,1,0,-1,-1,-2,-3,-4,-2,0,1,0,0,1,0,1,0,0,0,0,-1,-1,-1,-1,-2,-2,-2,-2,-1,-1,0,0,0,0,0,0,0,-1,-3,-3,-4,-4,-3,-1,0,0,0,1,1,1,1,0,0,0,-1,-1,-1,-1,-2,-2,-1,-1,0,0,0,0,1,0,0,0,1,0,-3,-3,-3,-4,-4,-1,0,1,0,0,1,1,0,0,0,0,-1,-2,-2,-1,-1,-1,-1,0,0,0,1,1,0,0,0,1,1,0,0,-1,-2,-1,0,0,-1,-1,0,1,1,1,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,0,1,1,0,0,-1,0,0,0,1,0,0,-1,0,0,-1,-2,-3,-1,0,0,0,1,1,1,1,0,0,-1,-2,-2,-1,0,0,-1,-1,-1,-1,-1,-1,0,0,0,0,0,1,0,-2,-3,-4,-5,-4,-2,0,0,0,0,0,2,1,0,0,-1,-2,-2,-1,0,-1,-2,-2,-1,-1,0,-1,0,0,1,1,0,1,-1,-3,-3,-4,-6,-5,-3,0,0,0,0,0,0,1,0,0,0,-2,-2,-2,-1,-1,-2,-1,-1,0,0,0,0,0,0,0,0,1,0,-2,-4,-3,-3,-4,-3,0,1,0,0,0,1,1,0,0,0,-1,-2,-2,-1,-1,-1,-1,-1,0,0,1,1,1,0,0,1,0,0,0,0,-1,-1,-1,-1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,1,0,1,0,-1,-1,-1,0,-1,-3,-3,-1,0,0,0,1,1,1,1,0,0,-1,-2,-2,-1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,1,0,-2,-4,-6,-6,-4,-1,1,0,0,0,0,0,0,0,0,-1,-3,-3,-2,-1,-2,-2,-1,0,0,0,0,0,0,1,0,0,0,-2,-3,-2,-4,-6,-5,-2,0,0,0,0,0,0,1,0,0,-1,-3,-3,-2,-2,-2,-2,-1,0,0,0,0,0,0,1,0,0,1,0,-2,-3,-3,-3,-4,-4,-2,0,0,0,0,2,1,0,0,-1,-2,-2,-2,-1,0,-1,-1,0,0,0,1,1,0,0,0,0,1,1,0,-1,-2,-2,-1,-1,-1,0,0,0,1,0,1,0,0,0,0,0,-1,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-3,-3,-2,0,1,0,0,1,1,1,0,0,0,-1,-2,-1,0,0,0,-1,-1,-1,-1,-1,-1,1,0,0,0,0,0,-1,-2,-3,-5,-5,-3,0,1,0,0,0,0,1,0,0,0,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,0,0,0,0,-2,-3,-4,-6,-6,-3,-1,1,0,0,0,0,0,0,0,-1,-2,-2,-2,-1,-1,-1,-1,0,0,0,0,0,0,1,0,0,0,0,-1,-2,-3,-3,-4,-4,-2,0,0,0,0,0,1,1,0,-1,-2,-2,-2,-2,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,-1,-2,-1,-1,-1,-1,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,-2,-1,0,0,-2,-3,-1,0,0,0,0,1,0,1,1,0,-1,-2,-2,-1,0,0,-1,-1,0,0,-1,-1,0,1,0,0,0,1,0,-2,-2,-4,-6,-5,-3,0,0,0,0,0,0,0,1,0,-1,-3,-3,-2,-1,-1,-2,-1,0,0,0,0,-1,0,0,0,0,0,0,-2,-2,-3,-6,-7,-4,-2,1,0,0,0,0,0,1,0,-1,-3,-4,-3,-2,-1,-1,0,0,0,0,0,0,0,1,0,0,0,1,0,-2,-3,-3,-4,-5,-3,0,1,0,0,0,1,1,0,0,-1,-2,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,-1,-2,-2,-2,-2,-1,-1,0,1,0,0,0,1,0,0,-1,-1,-2,-2,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,-1,-1,-1,-2,-3,-3,-2,0,1,0,0,0,1,0,0,0,-1,-2,-3,-2,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,-1,-2,-3,-5,-6,-4,-1,1,0,0,0,0,0,1,0,-1,-2,-3,-2,-1,-1,-1,0,0,0,0,-1,-1,0,0,0,0,0,0,-1,-2,-3,-6,-6,-4,-1,1,0,0,0,0,0,1,0,-1,-3,-4,-3,-2,-1,-1,0,0,0,0,0,0,0,1,0,0,0,1,0,-2,-2,-3,-5,-5,-3,0,1,0,0,0,0,1,0,0,-1,-3,-3,-3,-1,-1,0,0,0,0,0,1,0,0,0,0,1,0,1,0,-1,-2,-2,-2,-1,-2,-1,0,1,0,0,0,0,0,0,-1,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-1,0,1,0,1,0,-1,-1,-1,-1,-2,-2,-1,0,1,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,-1,-1,-2,-4,-5,-3,-1,1,0,0,0,0,1,1,0,-1,-2,-3,-3,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,1,-1,-2,-3,-5,-6,-5,-3,0,0,0,0,0,0,1,0,0,-2,-4,-3,-2,-2,-1,-1,0,0,0,0,0,0,1,0,0,0,2,0,-2,-2,-3,-5,-5,-3,-1,1,0,0,0,0,0,1,0,-1,-3,-3,-3,-2,-1,-1,0,0,0,0,1,0,0,0,0,1,0,1,0,-1,-2,-2,-2,-2,-2,-1,0,1,0,0,0,1,0,0,0,-1,-2,-3,-2,-1,0,0,0,0,0,0,0,0,0,-1,0,0,1,1,0,-1,-1,-1,0,-1,-2,-2,0,0,0,0,0,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,-1,-1,0,1,0,0,0,0,0,-1,-2,-3,-5,-4,-2,0,0,0,0,0,0,1,0,0,-1,-3,-3,-2,-1,0,0,-1,-1,0,0,-1,-1,1,0,0,0,0,0,-1,-2,-3,-6,-6,-4,-1,1,0,0,0,0,0,0,0,-1,-3,-4,-3,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,1,-1,-2,-3,-4,-5,-5,-2,0,0,0,0,0,0,1,0,0,-2,-3,-3,-2,-1,-1,0,0,0,0,0,0,0,0,1,0,0,0,0,-1,-2,-2,-3,-4,-4,-2,0,1,0,0,0,1,0,0,-1,-2,-2,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0,-1,-1,-1,-1,-2,-2,-1,0,1,0,0,1,1,0,0,0,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,0,0,0,0,1,-1,-2,-2,-2,-3,-4,-3,0,1,0,0,0,0,1,0,0,-1,-2,-3,-2,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,1,-1,-2,-3,-5,-6,-5,-2,0,0,0,0,0,0,1,0,-1,-2,-4,-3,-2,-1,-1,0,0,0,0,0,0,0,0,0,0,0,1,-1,-2,-3,-5,-6,-5,-2,0,0,0,0,0,0,1,0,0,-2,-4,-3,-2,-2,-1,0,0,0,0,0,0,0,0,1,0,0,0,0,-1,-3,-3,-3,-4,-4,-2,0,0,0,0,0,1,1,0,-1,-2,-2,-3,-3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,-2,-2,-2,-2,-2,-2,-1,0,0,0,0,0,1,0,0,-1,-2,-3,-3,-2,0,0,0,0,0,0,0,0,-1,0,0,0,0,1,0,-1,-1,-2,-4,-5,-4,-1,1,0,0,0,0,1,0,0,-1,-3,-4,-3,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,1,0,-2,-2,-5,-6,-5,-2,0,0,0,0,0,0,1,0,0,-2,-4,-4,-2,-1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-2,-3,-4,-6,-5,-3,0,1,0,0,0,0,0,0,0,-1,-3,-4,-3,-2,-1,0,0,0,0,0,0,0,-1,0,0,0,0,1,0,-2,-2,-2,-4,-5,-3,0,1,0,0,0,0,1,0,0,-1,-2,-3,-3,-2,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,-2,-2,-1,-2,-2,-2,-1,0,0,0,0,1,0,0,0,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,-1,-1,-1,-2,-4,-3,-2,0,0,0,0,0,1,1,0,-1,-2,-2,-3,-2,0,0,0,0,0,0,-1,-1,-1,1,0,0,0,0,0,-1,-2,-3,-6,-6,-4,-1,1,0,0,0,0,0,0,0,-1,-3,-4,-3,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,1,-1,-2,-3,-5,-6,-5,-2,0,0,0,0,0,0,1,0,-1,-2,-3,-3,-2,-1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,-1,-2,-2,-3,-4,-4,-2,0,0,0,0,0,1,1,0,-1,-2,-3,-3,-3,-1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,-1,-2,-2,-1,-1,-2,-2,0,1,0,0,0,1,0,0,-1,-1,-2,-3,-2,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,1,0,-1,-1,-2,-4,-4,-3,0,1,0,0,0,0,1,0,0,-1,-3,-3,-2,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,-2,-3,-5,-6,-5,-2,1,0,0,0,0,0,1,0,-1,-3,-3,-3,-2,0,0,0,0,0,0,-1,-1,0,1,0,0,0,1,0,-2,-3,-4,-6,-6,-4,0,0,0,0,0,0,1,0,0,-2,-3,-3,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,-1,-3,-3,-3,-4,-3,-1,1,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,0,0,0,0,0,0,0,0,0,-1,0,1,0,2,0,0,-1,-1,-1,-2,-2,-2,-1,0,0,0,0,1,1,0,0,-1,-2,-3,-3,-2,0,0,0,0,0,0,0,0,-1,0,1,0,0,0,0,-1,-1,-2,-3,-4,-4,-2,0,0,0,0,0,0,1,0,-1,-2,-3,-3,-2,-1,0,0,0,0,0,0,-2,-1,1,0,0,0,1,0,-1,-2,-4,-5,-6,-5,-1,1,0,0,0,0,0,1,0,-2,-4,-4,-3,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,-2,-3,-4,-5,-5,-4,-1,1,0,0,0,0,1,0,0,-1,-3,-4,-3,-2,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,-1,-2,-3,-3,-2,-2,-1,0,2,0,0,0,1,0,0,-1,-2,-2,-3,-3,-1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,-1,-1,-2,-2,-3,-3,-2,0,0,0,0,0,1,1,0,-1,-2,-3,-3,-2,-1,0,0,0,0,0,0,-1,-1,0,1,0,0,0,0,0,-1,-2,-4,-5,-5,-3,0,0,0,0,0,0,1,0,0,-2,-4,-4,-2,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,-1,-2,-3,-5,-6,-5,-3,0,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,-1,-2,-3,-4,-5,-4,-2,0,0,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,-2,-3,-3,-2,-2,-1,-1,0,1,0,0,0,1,0,0,-1,-1,-2,-3,-3,-1,0,0,0,0,0,0,0,0,0,-1,0,1,0,1,0,-1,-1,-1,-1,-2,-3,-3,-1,1,0,0,0,0,1,0,0,-2,-3,-3,-3,-1,0,0,0,0,0,0,-1,-1,0,1,0,0,0,1,0,-1,-3,-4,-5,-5,-4,0,0,0,0,0,0,0,1,0,-2,-4,-4,-4,-2,-1,-1,0,0,0,0,0,-1,0,0,0,0,0,0,0,-2,-3,-5,-6,-5,-3,0,0,0,0,0,0,0,1,0,-2,-4,-4,-4,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,-2,-3,-3,-4,-4,-3,-1,1,0,0,0,0,0,1,0,-1,-2,-3,-4,-3,-1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,-2,-2,-2,-2,-2,-2,-1,0,1,0,0,0,1,0,0,-1,-2,-3,-3,-3,-1,0,0,0,0,0,0,0,0,-1,-1,0,1,0,1,0,-1,-1,-1,-2,-3,-4,-2,0,0,0,0,0,0,1,0,0,-2,-4,-4,-3,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,1,0,-1,-3,-5,-6,-6,-4,0,0,0,0,0,0,0,1,0,-2,-4,-5,-4,-2,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-3,-5,-6,-5,-4,0,0,0,0,0,0,0,1,0,-2,-4,-4,-4,-3,-1,-1,-1,0,0,1,1,0,0,0,1,0,0,1,0,-1,-2,-3,-3,-4,-3,-2,0,0,0,0,0,0,1,0,0,-1,-3,-4,-4,-3,-1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,-1,-2,-2,-2,-2,-1,-1,0,0,0,0,0,0,1,0,0,-1,-2,-3,-3,-3,-1,0,0,0,0,0,0,0,0,-1,0,0,0,0,1,0,-1,-1,-2,-3,-4,-4,-1,0,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,-1,-3,-5,-6,-5,-3,0,0,0,0,0,0,0,0,-1,-3,-4,-4,-3,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-3,-5,-6,-5,-3,0,0,0,0,0,0,0,1,0,-2,-4,-4,-4,-3,-1,-1,0,0,0,1,1,0,0,0,1,0,0,1,0,-2,-2,-2,-3,-4,-4,-2,0,0,0,0,0,0,1,0,0,-2,-4,-5,-4,-3,-1,0,0,0,1,1,0,1,0,0,-1,0,0,1,0,0,-2,-2,-1,-1,-2,-1,-1,0,1,0,0,0,1,0,0,-1,-2,-3,-3,-3,-1,0,0,1,1,1,1,0,-1,-1,0,0,0,0,1,0,0,-1,-1,-3,-4,-4,-2,0,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-2,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,-3,-5,-6,-5,-3,0,0,0,0,0,0,0,1,0,-3,-5,-5,-4,-2,-1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-1,-3,-4,-5,-5,-4,-1,1,0,0,0,0,0,1,0,-2,-4,-5,-4,-3,-1,-1,0,0,1,1,1,0,0,0,0,1,0,0,0,-1,-2,-2,-2,-4,-4,-4,-1,1,0,0,0,0,0,1,0,-1,-4,-5,-5,-4,-2,0,0,0,1,1,1,1,0,0,-1,0,0,1,1,0,-1,-2,-2,-2,-2,-2,-1,0,1,0,0,0,0,1,0,-1,-2,-3,-4,-3,-2,0,0,1,1,1,1,0,0,-2,-2,0,1,0,0,0,0,-1,-1,-2,-4,-4,-3,0,1,0,0,0,0,0,0,0,-2,-4,-4,-4,-2,0,0,0,0,0,0,0,-1,-2,0,0,0,0,0,0,0,-2,-3,-5,-6,-5,-2,0,0,0,0,0,0,1,0,-1,-3,-5,-5,-3,-1,0,0,0,0,1,0,0,-1,0,1,0,0,0,1,0,-2,-2,-4,-5,-5,-4,-1,0,0,0,0,0,0,1,0,-2,-4,-5,-4,-3,-1,0,0,0,1,1,1,1,0,-1,0,1,0,0,1,0,-2,-2,-2,-3,-4,-3,-1,0,0,0,0,0,1,0,0,-2,-4,-5,-4,-3,-1,0,0,0,1,1,1,1,0,0,-1,-1,0,1,1,0,0,-1,-2,-1,-2,-2,-2,-1,0,0,0,0,0,1,0,0,-2,-3,-3,-3,-2,-1,0,1,1,0,0,0,0,-1,-2,0,1,0,0,1,0,-1,-1,-2,-3,-4,-4,-1,0,0,0,0,0,0,1,0,-2,-3,-4,-4,-3,-1,0,0,0,0,0,0,0,-2,-1,1,0,0,0,1,0,-1,-2,-4,-5,-5,-4,-1,0,0,0,0,0,0,0,0,-2,-4,-4,-4,-2,0,0,0,0,0,0,0,0,-1,0,1,0,0,0,0,-1,-2,-3,-4,-5,-4,-3,0,0,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,-1,0,0,0,0,1,1,0,0,-1,0,1,0,0,0,-1,-2,-2,-2,-3,-4,-3,-1,0,0,0,0,0,1,0,0,-1,-3,-4,-4,-3,-1,0,0,0,0,1,1,1,0,0,-1,-1,0,1,1,0,0,-1,-2,-1,-2,-2,-2,-1,0,0,0,0,0,1,0,0,-2,-3,-3,-3,-2,-1,0,0,1,0,0,0,0,-1,-2,-1,0,0,0,1,0,-1,-1,-2,-3,-4,-4,-2,0,0,0,0,0,0,1,0,-2,-3,-4,-4,-3,-1,0,0,0,0,0,0,0,-2,-2,0,0,0,0,1,0,-2,-3,-4,-5,-6,-4,-1,0,0,0,0,0,0,1,0,-2,-4,-5,-4,-2,0,0,0,0,0,0,0,0,-1,0,1,0,0,0,1,-1,-2,-3,-4,-5,-5,-3,-1,2,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,-2,-2,-2,-3,-4,-3,-1,0,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-2,0,0,0,0,1,1,1,0,0,-1,-1,0,1,1,1,0,-1,-2,-1,-2,-2,-2,-1,0,0,0,0,0,1,0,-1,-2,-2,-3,-3,-2,-1,0,1,1,1,0,0,0,-1,-2,-1,0,0,0,0,0,-1,-2,-2,-3,-4,-4,-2,0,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,0,0,0,-1,-2,0,0,0,0,0,0,-2,-2,-4,-5,-5,-4,-2,1,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,1,0,0,0,-1,0,0,0,0,1,-1,-2,-2,-3,-4,-5,-3,-1,1,0,0,0,0,0,1,0,-1,-3,-4,-4,-3,-1,0,0,0,0,1,1,1,0,0,-1,0,1,0,1,0,-2,-3,-2,-2,-3,-3,-2,0,0,0,0,0,0,1,0,-1,-2,-4,-4,-3,-2,0,0,0,1,1,1,1,1,0,0,-1,-1,0,1,1,0,-1,-1,-1,-1,-1,-2,-1,0,1,0,0,0,1,0,0,-1,-2,-2,-3,-3,-2,0,0,1,1,0,0,0,0,-1,-2,-1,1,0,0,1,0,-1,-1,-2,-3,-4,-4,-1,1,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,-1,0,0,0,0,0,0,0,-2,-2,0,0,0,0,1,0,-2,-3,-4,-5,-5,-4,-1,0,0,1,0,0,1,0,0,-2,-3,-4,-4,-2,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,1,0,-2,-3,-3,-4,-4,-3,-1,1,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,-1,0,0,0,0,1,1,1,0,0,-1,0,1,0,1,0,-1,-2,-2,-2,-3,-3,-1,0,1,0,0,0,0,0,0,-1,-2,-3,-3,-3,-2,0,0,0,1,1,1,1,1,0,0,-1,-1,0,1,1,0,0,-1,-2,-1,-1,-2,-1,0,1,0,0,0,1,0,0,-1,-2,-2,-3,-2,-1,0,1,1,1,0,0,0,0,-2,-2,-1,1,0,0,1,0,-1,-2,-2,-3,-4,-4,-1,1,0,0,0,0,1,0,0,-2,-3,-3,-3,-2,0,0,0,0,0,0,0,0,-1,-2,0,0,0,0,0,0,-2,-3,-3,-4,-5,-3,-1,1,0,0,0,0,1,0,0,-2,-3,-4,-3,-2,-1,0,0,0,0,0,0,0,0,-1,-1,1,0,0,1,0,-2,-3,-3,-4,-4,-3,-1,0,0,0,0,0,1,0,0,-1,-2,-4,-3,-3,-1,0,0,0,0,0,1,1,0,0,-1,-1,0,1,1,1,0,-2,-2,-2,-2,-2,-2,0,1,0,0,0,0,1,0,-1,-2,-2,-3,-3,-2,-1,0,0,0,0,0,1,1,0,0,-1,-1,-1,0,0,1,0,0,-1,-1,0,0,-1,-1,0,1,0,0,0,0,0,-1,-1,-1,-1,-2,-1,-1,0,1,1,0,0,0,0,0,-1,-2,-2,0,1,0,0,1,0,-1,-2,-2,-3,-3,-2,0,0,0,0,0,1,0,0,-1,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,-2,-2,0,0,0,0,1,0,-2,-3,-3,-4,-4,-3,0,0,0,0,0,0,0,0,-1,-2,-2,-3,-3,-1,0,0,0,0,0,0,0,0,-1,-2,0,1,0,0,1,0,-2,-2,-2,-3,-4,-2,-1,1,0,0,0,0,1,0,0,-1,-2,-3,-3,-2,-1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,-1,-2,-2,-1,-1,0,0,0,1,0,0,1,0,0,-1,-1,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,-2,-2,-1,0,1,1,0,-1,-1,0,0,0,-1,-1,0,1,0,0,1,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,-1,-3,-2,0,0,0,0,0,-1,-1,-2,-3,-4,-3,-2,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,0,0,0,0,0,0,0,0,0,-1,-2,0,0,0,0,1,-1,-2,-2,-2,-3,-3,-2,0,1,0,0,0,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,1,0,0,-1,-2,-1,0,0,1,0,0,-2,-2,-1,-2,-2,-1,0,1,0,0,0,1,0,0,-1,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,1,1,0,0,-1,-1,-1,0,0,0,0,0,-1,0,0,0,0,0,0,1,1,1,0,0,-1,-1,0,0,-1,-1,0,0,0,1,1,0,0,0,0,0,0,-2,-3,-3,-1,1,0,1,0,0,0,0,0,-1,-2,-2,-1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,-2,-1,1,0,0,0,1,0,-1,-2,-3,-4,-3,-2,0,1,0,0,0,1,1,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,1,0,-1,-2,-3,-4,-4,-3,-1,1,0,0,0,1,0,0,0,0,-2,-3,-3,-2,0,0,0,0,0,0,1,1,0,0,-1,-1,-1,0,1,1,0,0,-1,-1,-1,-1,-1,-1,0,0,1,0,0,1,0,0,0,-1,-1,-2,-2,-1,0,0,1,1,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,-1,-1,0,0,1,1,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,-1,-2,-2,0,0,0,0,1,0,-1,-1,-2,-3,-4,-3,-2,0,0,0,0,1,0,0,0,0,-1,-2,-3,-1,0,0,0,0,0,0,0,0,-1,-2,-2,0,0,0,0,0,-1,-2,-2,-3,-4,-4,-2,0,0,0,0,0,1,0,0,0,-1,-3,-3,-3,-1,0,0,0,0,0,0,0,0,-1,-2,-2,-1,1,0,0,0,0,-1,-1,-1,-3,-3,-1,0,1,0,0,0,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,-1,-1,0,0,1,0,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,1,0,2,1,0,0,0,0,-1,-2,-2,-1,0,1,0,1,1,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,-2,-2,-2,0,0,0,0,1,0,-1,-2,-3,-4,-4,-3,-1,1,0,0,0,1,0,0,0,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-2,-2,0,0,0,0,1,0,-2,-2,-3,-4,-3,-2,0,0,0,0,0,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,0,1,1,1,0,0,-1,-1,-1,-1,-1,-1,0,1,0,0,1,0,0,0,0,-1,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,-1,0,0,0,1,1,0,0,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,0,-1,-1,-2,-2,0,1,0,0,1,0,0,0,-1,-2,-3,-3,-2,0,1,0,0,1,0,0,0,0,0,-1,-2,-1,0,0,0,0,0,0,0,0,-1,-2,-1,1,0,0,0,1,0,-2,-2,-3,-4,-4,-2,0,0,0,0,0,1,0,0,0,-2,-3,-3,-2,-1,0,0,0,0,0,0,0,0,-1,-2,-1,0,0,0,1,0,-1,-2,-2,-3,-3,-2,-1,0,0,0,0,2,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,-1,-1,-1,-1,0,0,0,1,0,0,0,0,0,0,0,0,-1,-2,-1,0,0,1,1,1,0,0,0,0,-1,-1,-2,-1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,-1,-2,-1,0,0,0,0,1,0,-1,-2,-3,-4,-5,-3,0,0,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-2,-2,0,0,0,0,1,0,-2,-2,-3,-4,-4,-2,-1,1,0,0,0,1,0,0,0,-1,-2,-3,-2,-1,0,0,0,0,0,0,1,0,0,-1,-2,-3,-1,0,0,1,1,0,0,0,-1,-2,-3,-1,0,0,0,0,2,0,0,0,0,0,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,0,1,0,1,0,0,0,0,0,-1,-2,-2,-1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,-2,-2,-1,1,0,0,0,1,0,-1,-2,-4,-5,-4,-2,0,0,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,1,0,0,-2,-3,-1,1,0,0,0,0,-1,-1,-2,-3,-4,-2,-1,0,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,1,1,1,0,0,-1,-1,-1,-1,-1,0,0,1,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,-1,0,1,1,1,0,0,0,0,0,-1,-1,-1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,0,1,0,0,1,0,0,0,-1,-2,-3,-3,-2,0,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,-1,-3,-3,-1,1,0,0,0,1,0,-2,-2,-3,-5,-4,-2,0,0,0,0,0,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,1,1,0,0,-2,-3,-2,0,1,0,1,1,0,-1,-1,-1,-3,-3,-2,0,1,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,1,0,1,0,0,0,0,-1,-2,-2,-2,-1,0,1,1,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,-1,-2,-2,0,1,0,0,0,0,-1,-2,-3,-4,-5,-4,-1,0,0,0,0,1,1,0,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,1,1,0,-1,-2,-3,-2,0,0,0,0,1,0,-1,-1,-3,-4,-3,-1,0,0,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,1,1,0,0,-1,0,-1,-1,-1,0,0,0,1,1,1,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,0,0,1,1,1,0,0,0,0,-1,-2,-2,-1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-1,1,0,0,0,1,0,-2,-2,-3,-4,-4,-2,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,-1,0,0,0,0,0,0,0,0,-1,-2,-3,-2,0,0,0,0,1,0,-1,-2,-3,-5,-4,-2,0,0,0,0,0,1,0,0,0,-1,-2,-3,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,1,1,1,1,0,-1,-1,-1,-2,-2,0,0,1,0,0,1,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,-1,-1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,-1,-2,-2,-2,0,1,1,1,1,1,1,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,-1,-2,-2,-1,2,0,0,0,0,-1,-2,-2,-3,-4,-3,-1,0,0,0,0,1,1,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,1,0,0,-1,-2,-2,-1,0,1,0,1,1,0,0,-1,-2,-3,-3,-1,0,1,0,0,1,0,0,0,0,-1,-2,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,1,1,1,0,0,0,0,0,0,-1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,0,1,0,1,1,0,0,0,0,-1,-3,-3,-1,0,1,1,1,0,1,1,1,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-1,0,0,0,0,1,0,-1,-3,-4,-4,-4,-2,0,0,0,0,0,1,0,0,0,-1,-2,-2,-1,-1,0,0,0,0,0,1,1,0,0,-1,-2,-3,-2,0,0,0,0,0,0,0,-1,-3,-4,-3,-2,0,1,0,0,1,1,0,0,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,-1,-1,0,1,1,1,1,0,0,-1,-1,-1,-2,-2,-1,0,1,0,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,-2,-1,0,1,0,1,0,0,0,0,-1,-2,-2,-1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,1,0,0,1,0,-1,-1,-2,-3,-4,-3,-1,1,0,0,0,1,0,0,0,0,-2,-3,-2,-1,0,0,0,0,0,0,1,0,0,0,-1,-2,-2,-1,1,0,0,1,0,0,-1,-2,-2,-3,-2,0,1,0,0,0,1,0,0,0,-1,-1,-2,-2,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,-1,-1,0,1,0,0,1,0,0,-1,-1,-2,-2,-2,-1,0,1,0,0,1,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-1,0,1,1,1,1,0,0,0,0,-1,-2,-1,0,0,1,1,1,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,1,1,1,0,0,0,-1,-1,-2,-2,-1,0,1,1,0,1,1,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-3,-3,0,1,0,0,1,0,0,0,0,-2,-3,-2,-1,0,0,0,1,0,0,0,0,0,-2,-2,-1,0,0,1,0,0,0,0,0,0,0,-1,-2,-1,-1,-1,0,1,0,0,0,1,0,-1,-2,-3,-4,-3,-1,0,1,0,0,1,1,0,0,-1,-1,-2,-1,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-2,-1,0,0,0,1,0,0,-1,-1,-1,-2,-2,-1,0,1,0,0,1,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,-2,-1,0,0,1,1,1,0,0,0,-1,-1,-2,-2,0,0,1,1,1,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,-2,-1,0,1,0,0,1,0,0,-1,-1,-2,-3,-3,-2,0,1,0,0,1,1,1,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,1,0,0,-1,-2,-3,-3,-1,1,0,0,1,1,0,-1,-1,-2,-3,-2,0,0,0,0,0,1,0,0,0,-1,-2,-2,-2,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,1,1,1,1,0,-1,-1,-1,-2,-2,0,0,0,1,1,1,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,1,0,0,0,0,-1,-1,-1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,1,0,0,1,0,0,-1,-1,-1,-2,-2,-1,0,1,0,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-2,0,0,0,0,1,0,-1,-2,-3,-4,-4,-3,0,1,0,0,0,1,0,0,0,-1,-3,-3,-2,-1,0,0,0,0,0,1,1,1,0,0,-1,-2,-2,-3,-3,-2,0,0,0,0,0,0,0,-1,-2,-3,-4,-3,-1,0,0,0,0,1,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,1,1,1,0,0,-1,-1,-1,-1,-1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,1,0,0,1,0,-1,0,0,-1,-2,-2,-1,0,1,0,1,0,0,0,0,0,-1,-2,-2,-1,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-2,-2,-1,0,0,0,0,0,0,0,-1,-2,-3,-4,-3,-2,0,0,0,0,0,1,0,0,-1,-2,-2,-2,-1,0,0,0,0,0,0,1,1,0,0,-1,-2,-2,-2,-2,-1,0,0,0,0,0,1,0,-1,-2,-4,-4,-2,0,1,0,0,0,1,1,0,0,-1,-2,-2,-2,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-2,-1,0,1,0,0,1,0,0,-1,-2,-3,-3,-3,-1,0,1,0,0,1,0,0,0,0,-1,-2,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-1,-1,0,0,1,0,1,1,0,0,-1,-1,-2,-2,-1,0,0,1,1,1,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,1,1,2,1,0,0,0,0,-1,-2,-2,-1,0,1,1,1,1,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-2,-2,-1,0,0,0,0,1,0,0,-1,-2,-3,-4,-3,-1,0,0,0,0,0,1,0,0,-1,-2,-3,-2,-1,0,0,0,0,0,1,1,1,0,0,-1,-1,-2,-2,-2,-2,-1,0,1,0,0,0,1,0,-1,-2,-3,-3,-2,-1,0,1,0,0,1,1,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,1,1,0,0,0,-1,-1,-2,-2,-1,0,1,1,1,1,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,1,0,0,1,0,0,0,-1,-3,-4,-4,-2,0,1,0,0,0,1,1,0,0,-1,-2,-3,-2,-1,0,0,0,0,0,1,1,1,0,0,-1,-2,-2,-2,-2,-1,0,1,0,0,0,1,0,0,-2,-3,-3,-2,-1,0,1,0,0,0,1,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,1,1,1,1,0,0,0,-1,-2,-2,-2,-1,0,1,1,1,1,1,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,1,0,0,0,0,0,-1,-1,-2,-1,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,1,0,0,0,0,0,0,-1,-2,-2,-1,0,1,1,1,1,0,1,0,0,-1,-2,-2,-1,0,0,0,0,0,0,1,0,0,0,-1,-1,-2,-2,-2,-2,0,1,0,0,0,0,1,0,0,-2,-3,-4,-4,-2,0,1,0,0,0,0,1,1,0,0,-1,-2,-2,-1,-1,0,0,0,0,0,1,1,1,0,0,-1,-1,-2,-2,-2,-2,0,1,0,0,0,1,0,0,-1,-2,-3,-2,-2,0,1,1,0,0,1,1,0,0,-1,-1,-2,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,0,0,1,1,1,1,0,0,0,0,-1,-2,-2,-1,0,0,1,1,1,1,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,1,0,0,0,0,0,0,-1,-2,-1,-1,0,0,0,0,0,0,1,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,1,1,1,0,0,0,0,-1,-2,-3,-2,-1,0,1,1,1,1,1,1,0,0,0,-1,-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-2,0,1,1,0,0,1,0,0,-1,-2,-3,-3,-3,-1,0,1,0,0,0,1,1,0,0,-1,-2,-2,-1,-1,0,0,0,0,0,0,1,0,0,0,0,-1,-1,-1,-1,-1,-1,0,1,1,2,1,1,0,0,-1,-2,-2,-2,-1,0,0,1,1,1,1,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,1,1,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,1,1,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,1,1,1,1,1,0,0,0,-1,-2,-2,-2,-1,0,0,1,1,1,1,1,1,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-2,-2,-1,-1,0,0,1,1,1,1,0,0,-1,-1,-2,-2,-2,-1,0,0,1,1,1,1,1,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,0,0,1,1,0,0,0,0,0,-1,-1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,1,1,1,1,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0};
        int sample = 0;
        do {
            auto block = reinterpret_cast<SonyS_DSP::BitRateReductionBlock*>(&ram[4 + 9 * sample]);
            block->header.flags.set_volume(SonyS_DSP::BitRateReductionBlock::MAX_VOLUME);
            block->header.flags.filter = 0;
            block->header.flags.is_loop = 0;
            block->header.flags.is_end = sample + 1 >= 13083 / 16;
            for (unsigned i = 0; i < 2 * SonyS_DSP::BitRateReductionBlock::NUM_SAMPLES; i+=2) {
                auto hi = hyaw[i + 16 * sample];
                auto lo =  hyaw[i + 16 * sample + 1] << 4;
                block->samples[i/2] = hi | lo;
            }
        } while(sample++ < 13083 / 16);

        // -------------------------------------------------------------------
        // MARK: Source Directory Paging and Indexing
        // -------------------------------------------------------------------
        apu[voice][channel].setWavePage(0);
        apu[voice][channel].setWaveIndex(0);
    }

    /// @brief Process the CV inputs for the given channel.
    ///
    /// @param args the sample arguments (sample rate, sample time, etc.)
    /// @param channel the polyphonic channel to process the CV inputs to
    ///
    inline void processChannel(unsigned voice, unsigned channel) {
        // ---------------------------------------------------------------
        // MARK: Frequency (1V/Octave -- exponential scale)
        // ---------------------------------------------------------------
        float pitch = params[PARAM_FREQ + voice].getValue();
        pitch += inputs[INPUT_VOCT + voice].getVoltage(channel);
        pitch += inputs[INPUT_FM + voice].getVoltage(channel) / 5.f;
        float frequency = rack::dsp::FREQ_C4 * powf(2.0, pitch);
        frequency = Math::clip(frequency, 0.0f, 20000.0f);
        apu[voice][channel].setFrequency(frequency);
        // ---------------------------------------------------------------
        // MARK: Amplifier Volume
        // ---------------------------------------------------------------
        const auto leftVolumeParam = params[PARAM_VOLUME_L + voice].getValue();
        const auto leftVolumeCV = inputs[INPUT_VOLUME_L + voice].getVoltage(channel);
        const auto leftVolume = Math::clip(leftVolumeParam + leftVolumeCV, -128.f, 127.f);
        apu[voice][channel].setVolumeLeft(leftVolume);
        const auto rightVolumeParam = params[PARAM_VOLUME_R + voice].getValue();
        const auto rightVolumeCV = inputs[INPUT_VOLUME_R + voice].getVoltage(channel);
        const auto rightVolume = Math::clip(rightVolumeParam + rightVolumeCV, -128.f, 127.f);
        apu[voice][channel].setVolumeRight(rightVolume);
        // -------------------------------------------------------------------
        // MARK: Gate input
        // -------------------------------------------------------------------
        const auto gate = inputs[INPUT_GATE + voice].getVoltage(channel);
        bool trigger = gateTriggers[voice][channel].process(rescale(gate, 0.01f, 2.f, 0.f, 1.f));
        // -------------------------------------------------------------------
        // MARK: Stereo output
        // -------------------------------------------------------------------
        SonyS_DSP::StereoSample output;
        // get a flag determining whether phase modulation is enabled for the voice
        pmTriggers[voice][channel].process(rescale(inputs[INPUT_PM_ENABLE + voice].getVoltage(channel), 0.01f, 2.f, 0.f, 1.f));
        bool is_pm = (1 - params[PARAM_PM_ENABLE + voice].getValue()) - !pmTriggers[voice][channel].isHigh();
        // run the sample through the voice
        apu[voice][channel].run(
            output,
            trigger,
            gateTriggers[voice][channel].isHigh(),
            is_pm ? apu[voice - 1][channel].getOutput() : 0
        );
        outputs[OUTPUT_AUDIO_L + voice].setVoltage(5.f * output.samples[0] / std::numeric_limits<int16_t>::max(), channel);
        outputs[OUTPUT_AUDIO_R + voice].setVoltage(5.f * output.samples[1] / std::numeric_limits<int16_t>::max(), channel);
    }

    /// @brief Process the CV inputs for the given channel.
    ///
    /// @param args the sample arguments (sample rate, sample time, etc.)
    ///
    inline void process(const ProcessArgs& args) final {
        // get the number of polyphonic channels (defaults to 1 for monophonic).
        // also set the channels on the output ports based on the number of
        // channels
        unsigned channels = 1;
        for (unsigned port = 0; port < inputs.size(); port++)
            channels = std::max(inputs[port].getChannels(), static_cast<int>(channels));
        // set the number of polyphony channels for output ports
        for (unsigned port = 0; port < outputs.size(); port++)
            outputs[port].setChannels(channels);
        // process audio samples on the chip engine.
        for (unsigned voice = 0; voice < NUM_VOICES; voice++)
            for (unsigned channel = 0; channel < channels; channel++)
                processChannel(voice, channel);
    }
};

// ---------------------------------------------------------------------------
// MARK: Widget
// ---------------------------------------------------------------------------

/// The panel widget for SPC700.
struct SuperSamplerWidget : ModuleWidget {
    /// @brief Initialize a new widget.
    ///
    /// @param module the back-end module to interact with
    ///
    explicit SuperSamplerWidget(SuperSampler *module) {
        setModule(module);
        static constexpr auto panel = "res/S-SMP-BRR-Light.svg";
        setPanel(APP->window->loadSvg(asset::plugin(plugin_instance, panel)));
        // panel screws
        addChild(createWidget<ScrewSilver>(Vec(RACK_GRID_WIDTH, 0)));
        addChild(createWidget<ScrewSilver>(Vec(box.size.x - 2 * RACK_GRID_WIDTH, 0)));
        addChild(createWidget<ScrewSilver>(Vec(RACK_GRID_WIDTH, RACK_GRID_HEIGHT - RACK_GRID_WIDTH)));
        addChild(createWidget<ScrewSilver>(Vec(box.size.x - 2 * RACK_GRID_WIDTH, RACK_GRID_HEIGHT - RACK_GRID_WIDTH)));
        // individual oscillator controls
        for (unsigned i = 0; i < SuperSampler::NUM_VOICES; i++) {
            // Frequency
            addInput(createInput<PJ301MPort>(Vec(15, 40 + i * 41), module, SuperSampler::INPUT_VOCT + i));
            addInput(createInput<PJ301MPort>(Vec(45, 40 + i * 41), module, SuperSampler::INPUT_FM + i));
            addParam(createParam<Rogan2PWhite>(Vec(75, 35 + i * 41), module, SuperSampler::PARAM_FREQ + i));
            // Gate
            addInput(createInput<PJ301MPort>(Vec(120, 40 + i * 41), module, SuperSampler::INPUT_GATE + i));
            // Volume - Left
            addInput(createInput<PJ301MPort>(Vec(155, 40 + i * 41), module, SuperSampler::INPUT_VOLUME_L + i));
            auto left = createParam<Rogan2PWhite>(Vec(190, 35 + i * 41), module, SuperSampler::PARAM_VOLUME_L + i);
            left->snap = true;
            addParam(left);
            // Volume - Right
            addInput(createInput<PJ301MPort>(Vec(240, 40 + i * 41), module, SuperSampler::INPUT_VOLUME_R + i));
            auto right = createParam<Rogan2PRed>(Vec(275, 35 + i * 41), module, SuperSampler::PARAM_VOLUME_R + i);
            right->snap = true;
            addParam(right);
            // Phase Modulation
            if (i > 0) {  // phase modulation is not defined for the first voice
                addParam(createParam<CKSS>(Vec(330, 40  + i * 41), module, SuperSampler::PARAM_PM_ENABLE + i));
                addInput(createInput<PJ301MPort>(Vec(350, 40 + i * 41), module, SuperSampler::INPUT_PM_ENABLE + i));
            }
            // Output
            addOutput(createOutput<PJ301MPort>(Vec(380, 40 + i * 41), module, SuperSampler::OUTPUT_AUDIO_L + i));
            addOutput(createOutput<PJ301MPort>(Vec(410, 40 + i * 41), module, SuperSampler::OUTPUT_AUDIO_R + i));
        }
    }
};

/// the global instance of the model
rack::Model *modelSuperSampler = createModel<SuperSampler, SuperSamplerWidget>("SuperSampler");
